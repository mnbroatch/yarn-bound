!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.YarnBound=t():e.YarnBound=t()}(this,(()=>(()=>{"use strict";var e={352:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(s(424)),i=a(s(557));function a(e){return e&&e.__esModule?e:{default:e}}const{OptionsResult:o,TextResult:r,CommandResult:l}=i.default;n.default.OptionsResult=o,n.default.TextResult=r,n.default.CommandResult=l;var d=n.default;t.default=d,e.exports=t.default},279:(e,t)=>{function s(e,t){const s=e.match(/^\/?([^\s=/]+)(\/|\s|$)/),i="/"===e[0],a="/"===e[e.length-1];if("/"===e)return{name:"closeall",isCloseAll:!0};if(i)return{name:s[1],isClosing:!0};{const i=(s?e.replace(s[0],""):e).match(/(\S+?".*?"|[^\s/]+)/g);let o={};i&&(o=i.reduce(((e,t)=>({...e,...n(t)})),{}));const r=s&&s[1]||Object.keys(o)[0];let l;return"select"===r?l=function(e){return e[e.value]}(o):"plural"===r?l=function(e,t){return e[new Intl.PluralRules(t).select(e.value)].replaceAll("%",e.value)}(o,t):"ordinal"===r&&(l=function(e,t){return e[new Intl.PluralRules(t,{type:"ordinal"}).select(e.value)].replaceAll("%",e.value)}(o,t)),{name:r,properties:o,isSelfClosing:a,replacement:l}}}function n(e){const[t,...s]=e.split("="),n=s.join("=");if(!t||!n)throw new Error("Invalid markup property assignment: ".concat(e));let i;return i="true"===n||"false"===n?"true"===n:/^-?\d*\.?\d+$/.test(n)?+n:'"'===n[0]&&'"'===n[n.length-1]?n.slice(1,-1):n,{[t]:i}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){e.markup=[],function(e){const t=e.text.match(/^(\S+):\s+/);t&&(e.text=e.text.replace(t[0],""),e.markup.push({name:"character",properties:{name:t[1]}}))}(e),function(e,t){const n=[];let i=!1;const a=/(^|[^\\])\[(.*?[^\\])\](.|$)/;let o=e.text,r="",l=o.match(a);for(;l;){const{index:e}=l,[d,u,c,h]=l,p=/\s/.test(u),f=/\s/.test(h),x={...s(c,t),position:r.length+e+u.length};if(i&&"nomarkup"!==x.name)r+=o.slice(0,e+d.length-1),o=o.slice(e+d.length-1);else{const t="select"===x.name||"plural"===x.name||"ordinal"===x.name,s=!t&&x.isSelfClosing&&x.properties&&!1!==x.properties.trimwhitespace&&(0===e&&f||p&&f);x.properties&&delete x.properties.trimwhitespace;const i=u+(x.replacement||"")+(s?h.slice(1):h);o=o.replace(a,i),r+=o.slice(0,e+i.slice(1).length),o=o.slice(e+i.slice(1).length),t||"nomarkup"===x.name||n.push(x)}"nomarkup"===x.name&&(i=!x.isClosing),l=o.match(a)}e.text=r+o;const d=/\\(\[|\])/;for(l=e.text.match(d),o=e.text,r="";l;){const e=l[1];n.forEach((e=>{e.position>r.length+l.index&&(e.position-=1)})),o=o.replace(d,e),r+=o.slice(0,l.index+1),o=o.slice(l.index+1),l=o.match(d)}e.text=r+o;const u={};n.forEach((t=>{if(u[t.name]||(u[t.name]=[]),t.isClosing&&!u[t.name].length)throw new Error("Encountered closing ".concat(t.name," tag before opening tag"));if(t.isClosing){const s=u[t.name].pop();e.markup.push({name:s.name,position:s.position,properties:s.properties,length:t.position-s.position})}else if(t.isSelfClosing)e.markup.push({name:t.name,position:t.position,properties:t.properties,length:0});else if(t.isCloseAll){const s=Object.values(u).flat();for(;s.length;){const n=s.pop();e.markup.push({name:n.name,position:n.position,properties:n.properties,length:t.position-n.position})}}else u[t.name].push({name:t.name,position:t.position,properties:t.properties})}))}(e,t),e.text=e.text.replace(/(?:\\(.))/g,"$1")},e.exports=t.default},424:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(s(557)),i=a(s(279));function a(e){return e&&e.__esModule?e:{default:e}}t.default=class{constructor(e){let{dialogue:t,variableStorage:s,functions:i,handleCommand:a,combineTextAndOptionsResults:o,locale:r,startAt:l="Start"}=e;this.handleCommand=a,this.combineTextAndOptionsResults=o,this.yarnParser=n.default,this.bufferedNode=null,this.currentResult=null,this.history=[],this.locale=r,this.runner=new n.default.Runner,this.runner.noEscape=!0,this.runner.load(t),s&&(s.display=s.display||s.get,this.runner.setVariableStorage(s)),i&&Object.entries(i).forEach((e=>{this.registerFunction(...e)})),this.jump(l)}jump(e){this.generator=this.runner.run(e),this.advance()}advance(e){void 0!==e&&this.currentResult&&this.currentResult.select&&this.currentResult.select(e);let t=this.bufferedNode||this.generator.next().value,s=null;if(this.handleCommand)for(;t instanceof n.default.CommandResult;)this.handleCommand(t),t=this.generator.next().value;if(!(t instanceof n.default.OptionsResult)){const e=this.generator.next();s=e.value,t instanceof n.default.TextResult&&this.combineTextAndOptionsResults&&s instanceof n.default.OptionsResult?(t=Object.assign(s,t),s=null):t&&e.done&&(t=Object.assign(t,{isDialogueEnd:!0}))}this.currentResult&&this.history.push(this.currentResult),t instanceof n.default.TextResult?(0,i.default)(t,this.locale):t instanceof n.default.OptionsResult&&(t.text&&(0,i.default)(t,this.locale),t.options.forEach((e=>{(0,i.default)(e,this.locale)}))),this.currentResult=t,this.bufferedNode=s}registerFunction(e,t){this.runner.registerFunction(e,t)}},e.exports=t.default},547:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=[],s=e.split(/\r?\n+/).filter((e=>!e.match(/^\s*$/)));let n,i=null,a=!1,o="",r=0;for(;"#"===s[r].trim()[0];)n||(n=[]),n.push(s[r].trim().substr(1)),r+=1;for(;r<s.length;r+=1)if("==="===s[r].trim())a=!1,n&&(i.filetags=n),t.push(i),i=null;else if(a)i.body+="".concat(s[r].replace(o,""),"\n");else if("---"===s[r].trim())a=!0,i.body="",o=s[r].match(/^\s*/)[0];else if(s[r].indexOf(":")>-1){const[e,t]=s[r].split(":"),n=e.trim(),a=t.trim();if("body"!==n){if(null==i&&(i={}),i[n])throw new Error("Duplicate tag on node: ".concat(n));i[n]=a}}return t},e.exports=t.default},444:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=class{constructor(){this.data={}}set(e,t){this.data[e]=t}get(e){return this.data[e]}},e.exports=t.default},557:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(s(904)),i=a(s(836));function a(e){return e&&e.__esModule?e:{default:e}}n.default.OptionsResult=i.default.OptionsResult,n.default.TextResult=i.default.TextResult,n.default.CommandResult=i.default.CommandResult;var o=n.default;t.default=o,e.exports=t.default},938:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,i=(n=s(941))&&n.__esModule?n:{default:n};t.default=class{constructor(){this.transitions=[],this.textRule=null,this.isTrackingNextIndentation=!1}addTransition(e,t,s){return this.transitions.push({token:e,regex:i.default[e],state:t||null,delimitsText:s||!1}),this}addTextRule(e,t){if(this.textRule)throw new Error("Cannot add more than one text rule to a state.");const s=[];this.transitions.forEach((e=>{e.delimitsText&&s.push("(".concat(e.regex.source,")"))}));const n="((?!".concat(s.join("|"),").)+");return this.addTransition(e,t),this.textRule=this.transitions[this.transitions.length-1],this.textRule.regex=new RegExp(n),this}setTrackNextIndentation(e){return this.isTrackingNextIndentation=e,this}},e.exports=t.default},253:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,i=(n=s(312))&&n.__esModule?n:{default:n};t.default=class{constructor(){this.states=i.default.makeStates(),this.state="base",this.originalText="",this.lines=[],this.indentation=[[0,!1]],this.shouldTrackNextIndentation=!1,this.previousLevelOfIndentation=0,this.reset()}reset(){this.yytext="",this.yylloc={first_column:1,first_line:1,last_column:1,last_line:1},this.yylineno=1}lex(){if(this.isAtTheEndOfText()){this.yytext="";const e=this.indentation.pop();return e&&e[1]?"Dedent":"EndOfInput"}return this.isAtTheEndOfLine()?(this.advanceLine(),"EndOfLine"):this.lexNextTokenOnCurrentLine()}advanceLine(){this.yylineno+=1;const e=this.getCurrentLine().replace(/\t/,"    ");this.lines[this.yylineno-1]=e,this.previousLevelOfIndentation=this.getLastRecordedIndentation()[0],this.yytext="",this.yylloc={first_column:1,first_line:this.yylineno,last_column:1,last_line:this.yylineno}}lexNextTokenOnCurrentLine(){const e=this.getCurrentLineIndentation();if(this.shouldTrackNextIndentation&&e>this.previousLevelOfIndentation)return this.indentation.push([e,!0]),this.shouldTrackNextIndentation=!1,this.yylloc.first_column=this.yylloc.last_column,this.yylloc.last_column+=e,this.yytext="","Indent";if(e<this.getLastRecordedIndentation()[0]){if(this.indentation.pop()[1])return this.yytext="",this.previousLevelOfIndentation=this.getLastRecordedIndentation()[0],"Dedent";this.lexNextTokenOnCurrentLine()}e===this.previousLevelOfIndentation&&1===this.yylloc.last_column&&(this.yylloc.last_column+=e);const t=this.getState().transitions;for(let s=0,n=t.length;s<n;s+=1){const n=t[s],i=this.getCurrentLine().substring(this.yylloc.last_column-1).match(n.regex);if(null!==i&&0===i.index){const t=i[0];this.yytext=this.getCurrentLine().substr(this.yylloc.last_column-1,t.length),"String"===n.token&&(this.yytext=this.yytext.substring(1,this.yytext.length-1)),this.yylloc.first_column=this.yylloc.last_column,this.yylloc.last_column+=t.length,n.state&&(this.setState(n.state),this.shouldTrackNextIndentation&&this.getLastRecordedIndentation()[0]<e&&this.indentation.push([e,!1]));const s=this.states[n.state],a=!n.state||s.transitions.find((e=>"Text"===e.token));if("EndInlineExp"!==n.token&&"EscapedCharacter"!==n.token||!a){const e=this.getCurrentLine().substring(this.yylloc.last_column-1).match(/^\s*/);e[0]&&(this.yylloc.last_column+=e[0].length)}return n.token}}throw new Error("Invalid syntax in: ".concat(this.getCurrentLine()))}setState(e){if(void 0===this.states[e])throw new Error("Cannot set the unknown state [".concat(e,"]"));this.state=e,this.getState().isTrackingNextIndentation&&(this.shouldTrackNextIndentation=!0)}setInput(e){this.originalText=e.replace(/(\r\n)/g,"\n").replace(/\r/g,"\n").replace(/[\n\r]+$/,""),this.lines=this.originalText.split("\n"),this.reset()}getState(){return this.states[this.state]}getCurrentLine(){return this.lines[this.yylineno-1]}getCurrentLineIndentation(){return this.getCurrentLine().match(/^(\s*)/g)[0].length}getLastRecordedIndentation(){return 0===this.indentation.length?[0,!1]:this.indentation[this.indentation.length-1]}isAtTheEndOfText(){return this.isAtTheEndOfLine()&&this.yylloc.first_line>=this.lines.length}isAtTheEndOfLine(){return this.yylloc.last_column>this.getCurrentLine().length}},e.exports=t.default},312:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,i=(n=s(938))&&n.__esModule?n:{default:n},a={makeStates:function(){return{base:(new i.default).addTransition("EscapedCharacter",null,!0).addTransition("Comment",null,!0).addTransition("Hashtag",null,!0).addTransition("BeginCommand","command",!0).addTransition("BeginInlineExp","inlineExpression",!0).addTransition("ShortcutOption","shortcutOption").addTextRule("Text"),shortcutOption:(new i.default).setTrackNextIndentation(!0).addTransition("EscapedCharacter",null,!0).addTransition("Comment",null,!0).addTransition("Hashtag",null,!0).addTransition("BeginCommand","expression",!0).addTransition("BeginInlineExp","inlineExpressionInShortcut",!0).addTextRule("Text","base"),command:(new i.default).addTransition("If","expression").addTransition("Else").addTransition("ElseIf","expression").addTransition("EndIf").addTransition("Set","assignment").addTransition("Declare","declare").addTransition("Jump","jump").addTransition("Stop","stop").addTransition("BeginInlineExp","inlineExpressionInCommand",!0).addTransition("EndCommand","base",!0).addTextRule("Text"),commandArg:(new i.default).addTextRule("Text"),commandParenArgOrExpression:(new i.default).addTransition("EndCommand","base",!0).addTransition("LeftParen","expression").addTransition("Variable","expression").addTransition("Number","expression").addTransition("String").addTransition("True").addTransition("False").addTransition("Null").addTransition("RightParen"),assignment:(new i.default).addTransition("Variable").addTransition("EqualToOrAssign","expression"),declare:(new i.default).addTransition("Variable").addTransition("EndCommand","base").addTransition("EqualToOrAssign","expression"),jump:(new i.default).addTransition("Identifier").addTransition("BeginInlineExp","inlineExpressionInCommand",!0).addTransition("EndCommand","base",!0),stop:(new i.default).addTransition("EndCommand","base",!0),expression:(new i.default).addTransition("As").addTransition("ExplicitType").addTransition("EndCommand","base").addTransition("Number").addTransition("String").addTransition("LeftParen").addTransition("RightParen").addTransition("EqualTo").addTransition("EqualToOrAssign").addTransition("NotEqualTo").addTransition("GreaterThanOrEqualTo").addTransition("GreaterThan").addTransition("LessThanOrEqualTo").addTransition("LessThan").addTransition("Add").addTransition("UnaryMinus").addTransition("Minus").addTransition("Exponent").addTransition("Multiply").addTransition("Divide").addTransition("Modulo").addTransition("And").addTransition("Or").addTransition("Xor").addTransition("Not").addTransition("Variable").addTransition("Comma").addTransition("True").addTransition("False").addTransition("Null").addTransition("Identifier").addTextRule(),inlineExpression:(new i.default).addTransition("EndInlineExp","base").addTransition("Number").addTransition("String").addTransition("LeftParen").addTransition("RightParen").addTransition("EqualTo").addTransition("EqualToOrAssign").addTransition("NotEqualTo").addTransition("GreaterThanOrEqualTo").addTransition("GreaterThan").addTransition("LessThanOrEqualTo").addTransition("LessThan").addTransition("Add").addTransition("UnaryMinus").addTransition("Minus").addTransition("Exponent").addTransition("Multiply").addTransition("Divide").addTransition("Modulo").addTransition("And").addTransition("Or").addTransition("Xor").addTransition("Not").addTransition("Variable").addTransition("Comma").addTransition("True").addTransition("False").addTransition("Null").addTransition("Identifier").addTextRule("Text","base"),inlineExpressionInCommand:(new i.default).addTransition("EndInlineExp","command").addTransition("Number").addTransition("String").addTransition("LeftParen").addTransition("RightParen").addTransition("EqualTo").addTransition("EqualToOrAssign").addTransition("NotEqualTo").addTransition("GreaterThanOrEqualTo").addTransition("GreaterThan").addTransition("LessThanOrEqualTo").addTransition("LessThan").addTransition("Add").addTransition("UnaryMinus").addTransition("Minus").addTransition("Exponent").addTransition("Multiply").addTransition("Divide").addTransition("Modulo").addTransition("And").addTransition("Or").addTransition("Xor").addTransition("Not").addTransition("Variable").addTransition("Comma").addTransition("True").addTransition("False").addTransition("Null").addTransition("Identifier").addTextRule("Text","base"),inlineExpressionInShortcut:(new i.default).addTransition("EndInlineExp","shortcutOption").addTransition("Number").addTransition("String").addTransition("LeftParen").addTransition("RightParen").addTransition("EqualTo").addTransition("EqualToOrAssign").addTransition("NotEqualTo").addTransition("GreaterThanOrEqualTo").addTransition("GreaterThan").addTransition("LessThanOrEqualTo").addTransition("LessThan").addTransition("Add").addTransition("UnaryMinus").addTransition("Minus").addTransition("Exponent").addTransition("Multiply").addTransition("Divide").addTransition("Modulo").addTransition("And").addTransition("Or").addTransition("Xor").addTransition("Not").addTransition("Variable").addTransition("Comma").addTransition("True").addTransition("False").addTransition("Null").addTransition("Identifier").addTextRule("Text","base")}}};t.default=a,e.exports=t.default},941:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default={Whitespace:null,Indent:null,Dedent:null,EndOfLine:/\n/,EndOfInput:null,Number:/-?[0-9]+(\.[0-9+])?/,String:/"([^"\\]*(?:\\.[^"\\]*)*)"/,BeginCommand:/<</,EndCommand:/>>/,Variable:/\$([A-Za-z0-9_.])+/,ShortcutOption:/->/,Hashtag:/#([^(\s|#|//)]+)/,Comment:/\/\/.*/,OptionStart:/\[\[/,OptionDelimit:/\|/,OptionEnd:/\]\]/,If:/if(?!\w)/,ElseIf:/elseif(?!\w)/,Else:/else(?!\w)/,EndIf:/endif(?!\w)/,Jump:/jump(?!\w)/,Stop:/stop(?!\w)/,Set:/set(?!\w)/,Declare:/declare(?!\w)/,As:/as(?!\w)/,ExplicitType:/(String|Number|Bool)(?=>>)/,True:/true(?!\w)/,False:/false(?!\w)/,Null:/null(?!\w)/,LeftParen:/\(/,RightParen:/\)/,Comma:/,/,UnaryMinus:/-(?!\s)/,EqualTo:/(==|is(?!\w)|eq(?!\w))/,GreaterThan:/(>|gt(?!\w))/,GreaterThanOrEqualTo:/(>=|gte(?!\w))/,LessThan:/(<|lt(?!\w))/,LessThanOrEqualTo:/(<=|lte(?!\w))/,NotEqualTo:/(!=|neq(?!\w))/,Or:/(\|\||or(?!\w))/,And:/(&&|and(?!\w))/,Xor:/(\^|xor(?!\w))/,Not:/(!|not(?!\w))/,EqualToOrAssign:/(=|to(?!\w))/,Add:/\+/,Minus:/-/,Exponent:/\*\*/,Multiply:/\*/,Divide:/\//,Modulo:/%/,AddAssign:/\+=/,MinusAssign:/-=/,MultiplyAssign:/\*=/,DivideAssign:/\/=/,Identifier:/[a-zA-Z0-9_:.]+/,EscapedCharacter:/\\./,Text:/[^\\]/,BeginInlineExp:/{/,EndInlineExp:/}/},e.exports=t.default},968:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=se,t.parser=void 0;var s=function(e,t,s,n){for(s=s||{},n=e.length;n--;s[e[n]]=t);return s},n=[1,16],i=[1,17],a=[1,12],o=[1,19],r=[1,18],l=[5,18,19,23,34,36,77],d=[1,23],u=[1,24],c=[1,26],h=[1,27],p=[5,14,16,18,19,21,23,34,36,77],f=[1,30],x=[1,34],m=[1,35],T=[1,36],E=[1,37],y=[5,14,16,18,19,21,23,26,34,36,77],g=[1,50],N=[1,49],b=[1,44],v=[1,45],w=[1,46],O=[1,51],C=[1,52],_=[1,53],A=[1,54],L=[1,55],I=[5,16,18,19,23,34,36,77],k=[1,71],$=[1,72],R=[1,73],S=[1,74],M=[1,75],q=[1,76],j=[1,77],P=[1,78],B=[1,79],D=[1,80],G=[1,81],F=[1,82],V=[1,83],U=[1,84],X=[1,85],J=[26,46,51,53,54,55,56,57,58,60,61,62,63,64,65,66,67,68,70,78],H=[26,46,51,53,54,55,56,57,60,61,62,63,64,65,66,67,68,70,78],z=[26,46,51,70,78],Y=[1,122],Z=[1,123],W=[26,46,51,53,54,60,61,62,63,64,65,66,67,68,70,78],K=[26,46,51,60,61,62,63,64,65,66,67,68,70,78],Q=[51,70],ee=[16,18,19,23,34,77],te={trace:function(){},yy:{},symbols_:{error:2,node:3,statements:4,EndOfInput:5,conditionalBlock:6,statement:7,text:8,shortcut:9,genericCommand:10,assignmentCommand:11,jumpCommand:12,stopCommand:13,Comment:14,hashtags:15,EndOfLine:16,textNode:17,Text:18,EscapedCharacter:19,inlineExpression:20,Hashtag:21,conditional:22,BeginCommand:23,If:24,expression:25,EndCommand:26,EndIf:27,additionalConditionalBlocks:28,else:29,Else:30,elseif:31,ElseIf:32,shortcutOption:33,ShortcutOption:34,Indent:35,Dedent:36,Jump:37,Identifier:38,Stop:39,setCommandInner:40,declareCommandInner:41,Set:42,Variable:43,EqualToOrAssign:44,Declare:45,As:46,ExplicitType:47,functionArgument:48,functionCall:49,LeftParen:50,RightParen:51,UnaryMinus:52,Add:53,Minus:54,Exponent:55,Multiply:56,Divide:57,Modulo:58,Not:59,Or:60,And:61,Xor:62,EqualTo:63,NotEqualTo:64,GreaterThan:65,GreaterThanOrEqualTo:66,LessThan:67,LessThanOrEqualTo:68,parenExpressionArgs:69,Comma:70,literal:71,True:72,False:73,Number:74,String:75,Null:76,BeginInlineExp:77,EndInlineExp:78,$accept:0,$end:1},terminals_:{2:"error",5:"EndOfInput",14:"Comment",16:"EndOfLine",18:"Text",19:"EscapedCharacter",21:"Hashtag",23:"BeginCommand",24:"If",26:"EndCommand",27:"EndIf",30:"Else",32:"ElseIf",34:"ShortcutOption",35:"Indent",36:"Dedent",37:"Jump",38:"Identifier",39:"Stop",42:"Set",43:"Variable",44:"EqualToOrAssign",45:"Declare",46:"As",47:"ExplicitType",50:"LeftParen",51:"RightParen",52:"UnaryMinus",53:"Add",54:"Minus",55:"Exponent",56:"Multiply",57:"Divide",58:"Modulo",59:"Not",60:"Or",61:"And",62:"Xor",63:"EqualTo",64:"NotEqualTo",65:"GreaterThan",66:"GreaterThanOrEqualTo",67:"LessThan",68:"LessThanOrEqualTo",70:"Comma",72:"True",73:"False",74:"Number",75:"String",76:"Null",77:"BeginInlineExp",78:"EndInlineExp"},productions_:[0,[3,2],[4,1],[4,2],[4,1],[4,2],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,2],[7,2],[7,2],[17,1],[17,1],[8,1],[8,1],[8,2],[15,1],[15,2],[22,4],[6,6],[6,4],[6,2],[29,3],[29,2],[31,4],[31,2],[28,5],[28,5],[28,3],[33,2],[33,3],[33,2],[33,2],[33,3],[33,2],[9,1],[9,5],[10,3],[12,4],[12,4],[13,3],[11,3],[11,3],[40,4],[41,4],[41,6],[25,1],[25,1],[25,3],[25,2],[25,3],[25,3],[25,3],[25,3],[25,3],[25,3],[25,2],[25,3],[25,3],[25,3],[25,3],[25,3],[25,3],[25,3],[25,3],[25,3],[49,3],[49,4],[69,3],[69,1],[48,1],[48,1],[48,1],[71,1],[71,1],[71,1],[71,1],[71,1],[20,3]],performAction:function(e,t,s,n,i,a,o){var r=a.length-1;switch(i){case 1:return a[r-1].flat();case 2:case 4:case 7:case 8:case 9:case 10:case 11:case 17:case 18:case 73:this.$=[a[r]];break;case 3:case 19:this.$=a[r-1].concat(a[r]);break;case 5:this.$=a[r-1].concat([a[r]]);break;case 6:case 51:case 50:case 74:case 75:this.$=a[r];break;case 12:case 14:case 25:case 28:case 29:case 45:case 52:case 22:case 36:case 38:this.$=a[r-1];break;case 13:this.$=a[r-1].map((e=>Object.assign(e,{hashtags:a[r]})));break;case 15:this.$=new n.TextNode(a[r],this._$);break;case 16:this.$=new n.EscapedCharacterNode(a[r],this._$);break;case 20:this.$=[a[r].substring(1)];break;case 21:this.$=[a[r-1].substring(1)].concat(a[r]);break;case 23:this.$=new n.IfNode(a[r-5],a[r-3].flat());break;case 24:this.$=new n.IfElseNode(a[r-3],a[r-1].flat(),a[r]);break;case 26:case 27:this.$=void 0;break;case 30:this.$=new n.ElseNode(a[r-3].flat());break;case 31:this.$=new n.ElseIfNode(a[r-4],a[r-3].flat());break;case 32:this.$=new n.ElseIfNode(a[r-2],a[r-1].flat(),a[r]);break;case 33:this.$={text:a[r]};break;case 34:this.$={text:a[r-1],conditional:a[r]};break;case 35:this.$={...a[r-1],hashtags:a[r]};break;case 37:this.$={...a[r-2],hashtags:a[r-1]};break;case 39:this.$=new n.DialogShortcutNode(a[r].text,void 0,this._$,a[r].hashtags,a[r].conditional);break;case 40:this.$=new n.DialogShortcutNode(a[r-4].text,a[r-1].flat(),this._$,a[r-4].hashtags,a[r-4].conditional);break;case 41:this.$=new n.GenericCommandNode(a[r-1],this._$);break;case 42:case 43:this.$=new n.JumpCommandNode(a[r-1]);break;case 44:this.$=new n.StopCommandNode;break;case 46:this.$=null;break;case 47:this.$=new n.SetVariableEqualToNode(a[r-2].substring(1),a[r]);break;case 48:this.$=null,n.registerDeclaration(a[r-2].substring(1),a[r]);break;case 49:this.$=null,n.registerDeclaration(a[r-4].substring(1),a[r-2],a[r]);break;case 53:this.$=new n.UnaryMinusExpressionNode(a[r]);break;case 54:this.$=new n.ArithmeticExpressionAddNode(a[r-2],a[r]);break;case 55:this.$=new n.ArithmeticExpressionMinusNode(a[r-2],a[r]);break;case 56:this.$=new n.ArithmeticExpressionExponentNode(a[r-2],a[r]);break;case 57:this.$=new n.ArithmeticExpressionMultiplyNode(a[r-2],a[r]);break;case 58:this.$=new n.ArithmeticExpressionDivideNode(a[r-2],a[r]);break;case 59:this.$=new n.ArithmeticExpressionModuloNode(a[r-2],a[r]);break;case 60:this.$=new n.NegatedBooleanExpressionNode(a[r]);break;case 61:this.$=new n.BooleanOrExpressionNode(a[r-2],a[r]);break;case 62:this.$=new n.BooleanAndExpressionNode(a[r-2],a[r]);break;case 63:this.$=new n.BooleanXorExpressionNode(a[r-2],a[r]);break;case 64:this.$=new n.EqualToExpressionNode(a[r-2],a[r]);break;case 65:this.$=new n.NotEqualToExpressionNode(a[r-2],a[r]);break;case 66:this.$=new n.GreaterThanExpressionNode(a[r-2],a[r]);break;case 67:this.$=new n.GreaterThanOrEqualToExpressionNode(a[r-2],a[r]);break;case 68:this.$=new n.LessThanExpressionNode(a[r-2],a[r]);break;case 69:this.$=new n.LessThanOrEqualToExpressionNode(a[r-2],a[r]);break;case 70:this.$=new n.FunctionCallNode(a[r-2],[],this._$);break;case 71:this.$=new n.FunctionCallNode(a[r-3],a[r-1],this._$);break;case 72:this.$=a[r-2].concat([a[r]]);break;case 76:this.$=new n.VariableNode(a[r].substring(1));break;case 77:case 78:this.$=new n.BooleanLiteralNode(a[r]);break;case 79:this.$=new n.NumericLiteralNode(a[r]);break;case 80:this.$=new n.StringLiteralNode(a[r]);break;case 81:this.$=new n.NullLiteralNode(a[r]);break;case 82:this.$=new n.InlineExpressionNode(a[r-1],this._$)}},table:[{3:1,4:2,6:3,7:4,8:6,9:7,10:8,11:9,12:10,13:11,17:13,18:n,19:i,20:14,22:5,23:a,33:15,34:o,77:r},{1:[3]},{5:[1,20],6:21,7:22,8:6,9:7,10:8,11:9,12:10,13:11,17:13,18:n,19:i,20:14,22:5,23:a,33:15,34:o,77:r},s(l,[2,2],{16:d}),s(l,[2,4],{15:25,14:u,16:c,21:h}),{16:[1,28]},s([5,14,16,21,23,34,36],[2,6],{17:13,20:14,8:29,18:n,19:i,77:r}),s(p,[2,7]),s(p,[2,8]),s(p,[2,9]),s(p,[2,10]),s(p,[2,11]),{8:31,17:13,18:n,19:i,20:14,24:f,37:x,39:m,40:32,41:33,42:T,45:E,77:r},s(y,[2,17]),s(y,[2,18]),s(l,[2,39],{15:39,14:[1,40],16:[1,38],21:h}),s(y,[2,15]),s(y,[2,16]),{20:47,25:41,38:g,43:N,48:42,49:43,50:b,52:v,59:w,71:48,72:O,73:C,74:_,75:A,76:L,77:r},{8:56,17:13,18:n,19:i,20:14,77:r},{1:[2,1]},s(l,[2,3],{16:d}),s(l,[2,5],{15:25,14:u,16:c,21:h}),s(I,[2,25]),s(p,[2,12]),s(p,[2,13]),s(p,[2,14]),s([5,14,16,18,19,23,34,36,77],[2,20],{15:57,21:h}),{4:58,6:3,7:4,8:6,9:7,10:8,11:9,12:10,13:11,17:13,18:n,19:i,20:14,22:5,23:a,33:15,34:o,77:r},s([5,14,16,21,23,26,34,36],[2,19],{17:13,20:14,8:29,18:n,19:i,77:r}),{20:47,25:59,38:g,43:N,48:42,49:43,50:b,52:v,59:w,71:48,72:O,73:C,74:_,75:A,76:L,77:r},{8:29,17:13,18:n,19:i,20:14,26:[1,60],77:r},{26:[1,61]},{26:[1,62]},{20:64,38:[1,63],77:r},{26:[1,65]},{43:[1,66]},{43:[1,67]},s(p,[2,38],{35:[1,68]}),s([5,16,18,19,21,23,34,36,77],[2,35],{14:[1,69]}),s(p,[2,36]),{53:k,54:$,55:R,56:S,57:M,58:q,60:j,61:P,62:B,63:D,64:G,65:F,66:V,67:U,68:X,78:[1,70]},s(J,[2,50]),s(J,[2,51]),{20:47,25:86,38:g,43:N,48:42,49:43,50:b,52:v,59:w,71:48,72:O,73:C,74:_,75:A,76:L,77:r},{20:47,25:87,38:g,43:N,48:42,49:43,50:b,52:v,59:w,71:48,72:O,73:C,74:_,75:A,76:L,77:r},{20:47,25:88,38:g,43:N,48:42,49:43,50:b,52:v,59:w,71:48,72:O,73:C,74:_,75:A,76:L,77:r},s(J,[2,74]),s(J,[2,75]),s(J,[2,76]),{50:[1,89]},s(J,[2,77]),s(J,[2,78]),s(J,[2,79]),s(J,[2,80]),s(J,[2,81]),s([5,14,16,21,34,36],[2,33],{17:13,20:14,8:29,22:90,18:n,19:i,23:[1,91],77:r}),s(p,[2,21]),{6:21,7:22,8:6,9:7,10:8,11:9,12:10,13:11,17:13,18:n,19:i,20:14,22:5,23:[1,92],28:93,29:94,31:95,33:15,34:o,77:r},{26:[1,96],53:k,54:$,55:R,56:S,57:M,58:q,60:j,61:P,62:B,63:D,64:G,65:F,66:V,67:U,68:X},s(p,[2,41]),s(p,[2,45]),s(p,[2,46]),{26:[1,97]},{26:[1,98]},s(p,[2,44]),{44:[1,99]},{44:[1,100]},{4:101,6:3,7:4,8:6,9:7,10:8,11:9,12:10,13:11,17:13,18:n,19:i,20:14,22:5,23:a,33:15,34:o,77:r},s(p,[2,37]),s([5,14,16,18,19,21,23,26,34,36,46,51,53,54,55,56,57,58,60,61,62,63,64,65,66,67,68,70,77,78],[2,82]),{20:47,25:102,38:g,43:N,48:42,49:43,50:b,52:v,59:w,71:48,72:O,73:C,74:_,75:A,76:L,77:r},{20:47,25:103,38:g,43:N,48:42,49:43,50:b,52:v,59:w,71:48,72:O,73:C,74:_,75:A,76:L,77:r},{20:47,25:104,38:g,43:N,48:42,49:43,50:b,52:v,59:w,71:48,72:O,73:C,74:_,75:A,76:L,77:r},{20:47,25:105,38:g,43:N,48:42,49:43,50:b,52:v,59:w,71:48,72:O,73:C,74:_,75:A,76:L,77:r},{20:47,25:106,38:g,43:N,48:42,49:43,50:b,52:v,59:w,71:48,72:O,73:C,74:_,75:A,76:L,77:r},{20:47,25:107,38:g,43:N,48:42,49:43,50:b,52:v,59:w,71:48,72:O,73:C,74:_,75:A,76:L,77:r},{20:47,25:108,38:g,43:N,48:42,49:43,50:b,52:v,59:w,71:48,72:O,73:C,74:_,75:A,76:L,77:r},{20:47,25:109,38:g,43:N,48:42,49:43,50:b,52:v,59:w,71:48,72:O,73:C,74:_,75:A,76:L,77:r},{20:47,25:110,38:g,43:N,48:42,49:43,50:b,52:v,59:w,71:48,72:O,73:C,74:_,75:A,76:L,77:r},{20:47,25:111,38:g,43:N,48:42,49:43,50:b,52:v,59:w,71:48,72:O,73:C,74:_,75:A,76:L,77:r},{20:47,25:112,38:g,43:N,48:42,49:43,50:b,52:v,59:w,71:48,72:O,73:C,74:_,75:A,76:L,77:r},{20:47,25:113,38:g,43:N,48:42,49:43,50:b,52:v,59:w,71:48,72:O,73:C,74:_,75:A,76:L,77:r},{20:47,25:114,38:g,43:N,48:42,49:43,50:b,52:v,59:w,71:48,72:O,73:C,74:_,75:A,76:L,77:r},{20:47,25:115,38:g,43:N,48:42,49:43,50:b,52:v,59:w,71:48,72:O,73:C,74:_,75:A,76:L,77:r},{20:47,25:116,38:g,43:N,48:42,49:43,50:b,52:v,59:w,71:48,72:O,73:C,74:_,75:A,76:L,77:r},{51:[1,117],53:k,54:$,55:R,56:S,57:M,58:q,60:j,61:P,62:B,63:D,64:G,65:F,66:V,67:U,68:X},s(H,[2,53],{58:q}),s(z,[2,60],{53:k,54:$,55:R,56:S,57:M,58:q,60:j,61:P,62:B,63:D,64:G,65:F,66:V,67:U,68:X}),{20:47,25:120,38:g,43:N,48:42,49:43,50:b,51:[1,118],52:v,59:w,69:119,71:48,72:O,73:C,74:_,75:A,76:L,77:r},s(p,[2,34]),{24:f},{8:31,17:13,18:n,19:i,20:14,24:f,27:[1,121],30:Y,32:Z,37:x,39:m,40:32,41:33,42:T,45:E,77:r},s(I,[2,24]),{4:124,6:3,7:4,8:6,9:7,10:8,11:9,12:10,13:11,16:[1,125],17:13,18:n,19:i,20:14,22:5,23:a,33:15,34:o,77:r},{4:126,6:3,7:4,8:6,9:7,10:8,11:9,12:10,13:11,16:[1,127],17:13,18:n,19:i,20:14,22:5,23:a,33:15,34:o,77:r},s(p,[2,22]),s(p,[2,42]),s(p,[2,43]),{20:47,25:128,38:g,43:N,48:42,49:43,50:b,52:v,59:w,71:48,72:O,73:C,74:_,75:A,76:L,77:r},{20:47,25:129,38:g,43:N,48:42,49:43,50:b,52:v,59:w,71:48,72:O,73:C,74:_,75:A,76:L,77:r},{6:21,7:22,8:6,9:7,10:8,11:9,12:10,13:11,17:13,18:n,19:i,20:14,22:5,23:a,33:15,34:o,36:[1,130],77:r},s(W,[2,54],{55:R,56:S,57:M,58:q}),s(W,[2,55],{55:R,56:S,57:M,58:q}),s(H,[2,56],{58:q}),s(H,[2,57],{58:q}),s(H,[2,58],{58:q}),s(z,[2,59],{53:k,54:$,55:R,56:S,57:M,58:q,60:j,61:P,62:B,63:D,64:G,65:F,66:V,67:U,68:X}),s([26,46,51,60,70,78],[2,61],{53:k,54:$,55:R,56:S,57:M,58:q,61:P,62:B,63:D,64:G,65:F,66:V,67:U,68:X}),s([26,46,51,60,61,70,78],[2,62],{53:k,54:$,55:R,56:S,57:M,58:q,62:B,63:D,64:G,65:F,66:V,67:U,68:X}),s([26,46,51,60,61,62,70,78],[2,63],{53:k,54:$,55:R,56:S,57:M,58:q,63:D,64:G,65:F,66:V,67:U,68:X}),s(K,[2,64],{53:k,54:$,55:R,56:S,57:M,58:q}),s(K,[2,65],{53:k,54:$,55:R,56:S,57:M,58:q}),s(K,[2,66],{53:k,54:$,55:R,56:S,57:M,58:q}),s(K,[2,67],{53:k,54:$,55:R,56:S,57:M,58:q}),s(K,[2,68],{53:k,54:$,55:R,56:S,57:M,58:q}),s(K,[2,69],{53:k,54:$,55:R,56:S,57:M,58:q}),s(J,[2,52]),s(J,[2,70]),{51:[1,131],70:[1,132]},s(Q,[2,73],{53:k,54:$,55:R,56:S,57:M,58:q,60:j,61:P,62:B,63:D,64:G,65:F,66:V,67:U,68:X}),{26:[1,133]},{26:[1,134]},{20:47,25:135,38:g,43:N,48:42,49:43,50:b,52:v,59:w,71:48,72:O,73:C,74:_,75:A,76:L,77:r},{6:21,7:22,8:6,9:7,10:8,11:9,12:10,13:11,17:13,18:n,19:i,20:14,22:5,23:[1,136],33:15,34:o,77:r},s(ee,[2,27]),{6:21,7:22,8:6,9:7,10:8,11:9,12:10,13:11,17:13,18:n,19:i,20:14,22:5,23:[1,137],28:138,29:94,31:95,33:15,34:o,77:r},s(ee,[2,29]),{26:[2,47],53:k,54:$,55:R,56:S,57:M,58:q,60:j,61:P,62:B,63:D,64:G,65:F,66:V,67:U,68:X},{26:[2,48],46:[1,139],53:k,54:$,55:R,56:S,57:M,58:q,60:j,61:P,62:B,63:D,64:G,65:F,66:V,67:U,68:X},s(p,[2,40]),s(J,[2,71]),{20:47,25:140,38:g,43:N,48:42,49:43,50:b,52:v,59:w,71:48,72:O,73:C,74:_,75:A,76:L,77:r},s(I,[2,23]),s(ee,[2,26]),{26:[1,141],53:k,54:$,55:R,56:S,57:M,58:q,60:j,61:P,62:B,63:D,64:G,65:F,66:V,67:U,68:X},{8:31,17:13,18:n,19:i,20:14,24:f,27:[1,142],37:x,39:m,40:32,41:33,42:T,45:E,77:r},{8:31,17:13,18:n,19:i,20:14,24:f,27:[1,143],30:Y,32:Z,37:x,39:m,40:32,41:33,42:T,45:E,77:r},s(I,[2,32]),{47:[1,144]},s(Q,[2,72],{53:k,54:$,55:R,56:S,57:M,58:q,60:j,61:P,62:B,63:D,64:G,65:F,66:V,67:U,68:X}),s(ee,[2,28]),{26:[1,145]},{26:[1,146]},{26:[2,49]},s(I,[2,30]),s(I,[2,31])],defaultActions:{20:[2,1],144:[2,49]},parseError:function(e,t){if(!t.recoverable){var s=new Error(e);throw s.hash=t,s}this.trace(e)},parse:function(e){var t=this,s=[0],n=[null],i=[],a=this.table,o="",r=0,l=0,d=0,u=2,c=1,h=i.slice.call(arguments,1),p=Object.create(this.lexer),f={yy:{}};for(var x in this.yy)Object.prototype.hasOwnProperty.call(this.yy,x)&&(f.yy[x]=this.yy[x]);p.setInput(e,f.yy),f.yy.lexer=p,f.yy.parser=this,void 0===p.yylloc&&(p.yylloc={});var m=p.yylloc;i.push(m);var T=p.options&&p.options.ranges;"function"==typeof f.yy.parseError?this.parseError=f.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var E,y,g,N,b,v,w,O,C,_=function(){var e;return"number"!=typeof(e=p.lex()||c)&&(e=t.symbols_[e]||e),e},A={};;){if(g=s[s.length-1],this.defaultActions[g]?N=this.defaultActions[g]:(null==E&&(E=_()),N=a[g]&&a[g][E]),void 0===N||!N.length||!N[0]){var L="";for(v in C=[],a[g])this.terminals_[v]&&v>u&&C.push("'"+this.terminals_[v]+"'");L=p.showPosition?"Parse error on line "+(r+1)+":\n"+p.showPosition()+"\nExpecting "+C.join(", ")+", got '"+(this.terminals_[E]||E)+"'":"Parse error on line "+(r+1)+": Unexpected "+(E==c?"end of input":"'"+(this.terminals_[E]||E)+"'"),this.parseError(L,{text:p.match,token:this.terminals_[E]||E,line:p.yylineno,loc:m,expected:C})}if(N[0]instanceof Array&&N.length>1)throw new Error("Parse Error: multiple actions possible at state: "+g+", token: "+E);switch(N[0]){case 1:s.push(E),n.push(p.yytext),i.push(p.yylloc),s.push(N[1]),E=null,y?(E=y,y=null):(l=p.yyleng,o=p.yytext,r=p.yylineno,m=p.yylloc,d>0&&d--);break;case 2:if(w=this.productions_[N[1]][1],A.$=n[n.length-w],A._$={first_line:i[i.length-(w||1)].first_line,last_line:i[i.length-1].last_line,first_column:i[i.length-(w||1)].first_column,last_column:i[i.length-1].last_column},T&&(A._$.range=[i[i.length-(w||1)].range[0],i[i.length-1].range[1]]),void 0!==(b=this.performAction.apply(A,[o,l,r,f.yy,N[1],n,i].concat(h))))return b;w&&(s=s.slice(0,-1*w*2),n=n.slice(0,-1*w),i=i.slice(0,-1*w)),s.push(this.productions_[N[1]][0]),n.push(A.$),i.push(A._$),O=a[s[s.length-2]][s[s.length-1]],s.push(O);break;case 3:return!0}}return!0}};function se(){this.yy={}}t.parser=te,se.prototype=te,te.Parser=se},3:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;class s{}class n{}class i{}class a{}class o{}class r{}class l{}class d{}var u={types:{Text:s,Shortcut:n,Conditional:i,Assignment:a,Literal:o,Expression:r,FunctionCall:l,Command:d},DialogShortcutNode:class extends n{constructor(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4?arguments[4]:void 0;super(),this.type="DialogShortcutNode",this.text=e,this.content=t,this.lineNum=s.first_line,this.hashtags=n,this.conditionalExpression=i}},IfNode:class extends i{constructor(e,t){super(),this.type="IfNode",this.expression=e,this.statement=t}},IfElseNode:class extends i{constructor(e,t,s){super(),this.type="IfElseNode",this.expression=e,this.statement=t,this.elseStatement=s}},ElseNode:class extends i{constructor(e){super(),this.type="ElseNode",this.statement=e}},ElseIfNode:class extends i{constructor(e,t,s){super(),this.type="ElseIfNode",this.expression=e,this.statement=t,this.elseStatement=s}},GenericCommandNode:class extends d{constructor(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];super(),this.type="GenericCommandNode",this.command=e,this.hashtags=s,this.lineNum=t.first_line}},JumpCommandNode:class extends d{constructor(e){super(),this.type="JumpCommandNode",this.destination=e}},StopCommandNode:class extends d{constructor(){super(),this.type="StopCommandNode"}},TextNode:class extends s{constructor(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];super(),this.type="TextNode",this.text=e,this.lineNum=t.first_line,this.hashtags=s}},EscapedCharacterNode:class extends s{constructor(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];super(),this.type="EscapedCharacterNode",this.text=e,this.lineNum=t.first_line,this.hashtags=s}},NumericLiteralNode:class extends o{constructor(e){super(),this.type="NumericLiteralNode",this.numericLiteral=e}},StringLiteralNode:class extends o{constructor(e){super(),this.type="StringLiteralNode",this.stringLiteral=e}},BooleanLiteralNode:class extends o{constructor(e){super(),this.type="BooleanLiteralNode",this.booleanLiteral=e}},VariableNode:class extends o{constructor(e){super(),this.type="VariableNode",this.variableName=e}},UnaryMinusExpressionNode:class extends r{constructor(e){super(),this.type="UnaryMinusExpressionNode",this.expression=e}},ArithmeticExpressionAddNode:class extends r{constructor(e,t){super(),this.type="ArithmeticExpressionAddNode",this.expression1=e,this.expression2=t}},ArithmeticExpressionMinusNode:class extends r{constructor(e,t){super(),this.type="ArithmeticExpressionMinusNode",this.expression1=e,this.expression2=t}},ArithmeticExpressionMultiplyNode:class extends r{constructor(e,t){super(),this.type="ArithmeticExpressionMultiplyNode",this.expression1=e,this.expression2=t}},ArithmeticExpressionExponentNode:class extends r{constructor(e,t){super(),this.type="ArithmeticExpressionExponentNode",this.expression1=e,this.expression2=t}},ArithmeticExpressionDivideNode:class extends r{constructor(e,t){super(),this.type="ArithmeticExpressionDivideNode",this.expression1=e,this.expression2=t}},ArithmeticExpressionModuloNode:class extends r{constructor(e,t){super(),this.type="ArithmeticExpressionModuloNode",this.expression1=e,this.expression2=t}},NegatedBooleanExpressionNode:class extends r{constructor(e){super(),this.type="NegatedBooleanExpressionNode",this.expression=e}},BooleanOrExpressionNode:class extends r{constructor(e,t){super(),this.type="BooleanOrExpressionNode",this.expression1=e,this.expression2=t}},BooleanAndExpressionNode:class extends r{constructor(e,t){super(),this.type="BooleanAndExpressionNode",this.expression1=e,this.expression2=t}},BooleanXorExpressionNode:class extends r{constructor(e,t){super(),this.type="BooleanXorExpressionNode",this.expression1=e,this.expression2=t}},EqualToExpressionNode:class extends r{constructor(e,t){super(),this.type="EqualToExpressionNode",this.expression1=e,this.expression2=t}},NotEqualToExpressionNode:class extends r{constructor(e,t){super(),this.type="NotEqualToExpressionNode",this.expression1=e,this.expression2=t}},GreaterThanExpressionNode:class extends r{constructor(e,t){super(),this.type="GreaterThanExpressionNode",this.expression1=e,this.expression2=t}},GreaterThanOrEqualToExpressionNode:class extends r{constructor(e,t){super(),this.type="GreaterThanOrEqualToExpressionNode",this.expression1=e,this.expression2=t}},LessThanExpressionNode:class extends r{constructor(e,t){super(),this.type="LessThanExpressionNode",this.expression1=e,this.expression2=t}},LessThanOrEqualToExpressionNode:class extends r{constructor(e,t){super(),this.type="LessThanOrEqualToExpressionNode",this.expression1=e,this.expression2=t}},SetVariableEqualToNode:class extends a{constructor(e,t){super(),this.type="SetVariableEqualToNode",this.variableName=e,this.expression=t}},FunctionCallNode:class extends l{constructor(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];super(),this.type="FunctionCallNode",this.functionName=e,this.args=t,this.lineNum=s.first_line,this.hashtags=n}},InlineExpressionNode:class extends r{constructor(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];super(),this.type="InlineExpressionNode",this.expression=e,this.lineNum=t.first_line,this.hashtags=s}}};t.default=u,e.exports=t.default},370:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=o(s(3)),i=o(s(253)),a=s(968);function o(e){return e&&e.__esModule?e:{default:e}}a.parser.lexer=new i.default,a.parser.yy=n.default,a.parser.yy.declarations={},a.parser.yy.parseError=function(e){throw e},a.parser.yy.registerDeclaration=function(e,t,s){if(!this.areDeclarationsHandled){if(this.declarations[e])throw new Error("Duplicate declaration found for variable: ".concat(e));this.declarations[e]={variableName:e,expression:t,explicitType:s}}};var r=a.parser;t.default=r,e.exports=t.default},836:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;class s{}class n extends s{constructor(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=arguments.length>3?arguments[3]:void 0;super(),this.text=e,this.isAvailable=t,this.hashtags=s,this.metadata=n}}var i={Result:s,TextResult:class extends s{constructor(e,t,s){super(),this.text=e,this.hashtags=t,this.metadata=s}},CommandResult:class extends s{constructor(e,t,s){super(),this.command=e,this.hashtags=t,this.metadata=s}},OptionsResult:class extends s{constructor(e,t){super(),this.options=e.map((e=>new n(e.text,e.isAvailable,e.hashtags))),this.metadata=t}select(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;if(e<0||e>=this.options.length)throw new Error("Cannot select option #".concat(e,", there are ").concat(this.options.length," options"));this.selected=e}}};t.default=i,e.exports=t.default},904:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=l(s(370)),i=l(s(836)),a=l(s(444)),o=l(s(547)),r=l(s(3));function l(e){return e&&e.__esModule?e:{default:e}}const d=r.default.types;var u={Runner:class{constructor(){this.noEscape=!1,this.yarnNodes={},this.variables=new a.default,this.functions={}}load(e){if(!e)throw new Error("No dialogue supplied");let t;t="string"==typeof e?(0,o.default)(e):e,t.forEach((e=>{if(!e.title)throw new Error("Node needs a title: ".concat(JSON.stringify(e)));if(e.title.split(".").length>1)throw new Error("Node title cannot contain a dot: ".concat(e.title));if(!e.body)throw new Error("Node needs a body: ".concat(JSON.stringify(e)));if(this.yarnNodes[e.title])throw new Error("Duplicate node title: ".concat(e.title));this.yarnNodes[e.title]=e})),n.default.yy.areDeclarationsHandled=!1,n.default.yy.declarations={},this.handleDeclarations(t),n.default.yy.areDeclarationsHandled=!0}setVariableStorage(e){if("function"!=typeof e.set||"function"!=typeof e.get)throw new Error('Variable Storage object must contain both a "set" and "get" function');this.variables=e}handleDeclarations(e){const t={Number:0,String:"",Boolean:!1},s=e.reduce(((e,t)=>[...e,...t.body.split(/\r?\n+/)]),[]).reduce(((e,t)=>t.match(/^<<declare .+>>/)?[...e,t]:e),[]);s.length&&n.default.parse(s.join("\n")),Object.entries(n.default.yy.declarations).forEach((e=>{let[s,{expression:n,explicitType:i}]=e;const a=this.evaluateExpressionOrLiteral(n);if(i&&typeof a!=typeof t[i])throw new Error("Cannot declare value ".concat(a," as type ").concat(i," for variable ").concat(s));this.variables.get(s)||this.variables.set(s,a)}))}registerFunction(e,t){if("function"!=typeof t)throw new Error("Registered function must be...well...a function");this.functions[e]=t}*run(e){let t=e;for(;t;){const s=this.yarnNodes[t];if(void 0===s)throw new Error('Node "'.concat(e,'" does not exist'));const i=Array.from(n.default.parse(s.body)),a={...s};delete a.body;const o=yield*this.evalNodes(i,a);t=o&&o.jump}}*evalNodes(e,t){let s=[],n="";const a=e.filter(Boolean);for(let e=0;e<a.length;e+=1){const o=a[e],l=a[e+1];if(o instanceof d.Text||o instanceof d.Expression)n+=this.evaluateExpressionOrLiteral(o).toString(),l&&o.lineNum===l.lineNum&&(l instanceof d.Text||l instanceof d.Expression)||(yield new i.default.TextResult(n,o.hashtags,t),n="");else if(o instanceof d.Shortcut){if(s.push(o),!(l instanceof d.Shortcut)){const e=yield*this.handleShortcuts(s,t);if(e&&(e.stop||e.jump))return e;s=[]}}else if(o instanceof d.Assignment)this.evaluateAssignment(o);else if(o instanceof d.Conditional){const e=this.evaluateConditional(o);if(e){const s=yield*this.evalNodes(e,t);if(s&&(s.stop||s.jump))return s}}else{if(o instanceof r.default.JumpCommandNode)return{jump:o.destination};if(o instanceof r.default.StopCommandNode)return{stop:!0};{const e=this.evaluateExpressionOrLiteral(o.command);yield new i.default.CommandResult(e,o.hashtags,t)}}}}*handleShortcuts(e,t){const s=e.map((e=>{let t=!0;e.conditionalExpression&&!this.evaluateExpressionOrLiteral(e.conditionalExpression)&&(t=!1);const s=this.evaluateExpressionOrLiteral(e.text);return Object.assign(e,{isAvailable:t,text:s})})),n=new i.default.OptionsResult(s,t);if(yield n,"number"!=typeof n.selected)throw new Error("No option selected before resuming dialogue");{const e=s[n.selected];if(e.content)return yield*this.evalNodes(e.content,t)}}evaluateAssignment(e){const t=this.evaluateExpressionOrLiteral(e.expression),s=this.variables.get(e.variableName);if(s&&typeof s!=typeof t)throw new Error("Variable ".concat(e.variableName," is already type ").concat(typeof s,"; cannot set equal to ").concat(t," of type ").concat(typeof t));this.variables.set(e.variableName,t)}evaluateConditional(e){if("IfNode"===e.type){if(this.evaluateExpressionOrLiteral(e.expression))return e.statement}else{if("IfElseNode"!==e.type&&"ElseIfNode"!==e.type)return e.statement;if(this.evaluateExpressionOrLiteral(e.expression))return e.statement;if(e.elseStatement)return this.evaluateConditional(e.elseStatement)}return null}evaluateFunctionCall(e){if(this.functions[e.functionName])return this.functions[e.functionName](...e.args.map(this.evaluateExpressionOrLiteral,this));throw new Error('Function "'.concat(e.functionName,'" not found'))}evaluateExpressionOrLiteral(e){if(Array.isArray(e))return e.reduce(((e,t)=>e+this.evaluateExpressionOrLiteral(t).toString()),"");const t={UnaryMinusExpressionNode:e=>-e,ArithmeticExpressionAddNode:(e,t)=>e+t,ArithmeticExpressionMinusNode:(e,t)=>e-t,ArithmeticExpressionExponentNode:(e,t)=>e**t,ArithmeticExpressionMultiplyNode:(e,t)=>e*t,ArithmeticExpressionDivideNode:(e,t)=>e/t,ArithmeticExpressionModuloNode:(e,t)=>e%t,NegatedBooleanExpressionNode:e=>!e,BooleanOrExpressionNode:(e,t)=>e||t,BooleanAndExpressionNode:(e,t)=>e&&t,BooleanXorExpressionNode:(e,t)=>!!(e^t),EqualToExpressionNode:(e,t)=>e===t,NotEqualToExpressionNode:(e,t)=>e!==t,GreaterThanExpressionNode:(e,t)=>e>t,GreaterThanOrEqualToExpressionNode:(e,t)=>e>=t,LessThanExpressionNode:(e,t)=>e<t,LessThanOrEqualToExpressionNode:(e,t)=>e<=t,TextNode:e=>e.text,EscapedCharacterNode:e=>this.noEscape?e.text:e.text.slice(1),NumericLiteralNode:e=>parseFloat(e.numericLiteral),StringLiteralNode:e=>"".concat(e.stringLiteral),BooleanLiteralNode:e=>"true"===e.booleanLiteral,VariableNode:e=>this.variables.get(e.variableName),FunctionCallNode:e=>this.evaluateFunctionCall(e),InlineExpressionNode:e=>e}[e.type];if(!t)throw new Error("node type not recognized: ".concat(e.type));return t(e instanceof d.Expression?this.evaluateExpressionOrLiteral(e.expression||e.expression1):e,e.expression2?this.evaluateExpressionOrLiteral(e.expression2):e)}},TextResult:i.default.TextResult,CommandResult:i.default.CommandResult,OptionsResult:i.default.OptionsResult};t.default=u,e.exports=t.default}},t={};return function s(n){var i=t[n];if(void 0!==i)return i.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,s),a.exports}(352)})()));